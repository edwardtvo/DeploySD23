{"ast":null,"code":"import _slicedToArray from\"/Users/macos10.12/Documents/GitHub/SoftwareDesignGroup23/fuel-quote-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{Container,Button,Form,Row,Col,Modal,InputGroup}from'react-bootstrap';import React,{useEffect,useState}from\"react\";import DatePicker from'react-datepicker';import NavBar from'./NavBar';import{withCookies,useCookies}from'react-cookie';import{useHistory}from\"react-router-dom\";import axios from'axios';import'./QuoteForm.css';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";require('react-datepicker/dist/react-datepicker.css');function simulateNetworkRequest(){return new Promise(function(resolve){return setTimeout(resolve,100);});}var apiUrl='http://localhost:4000';axios.interceptors.request.use(function(config){var _URL=new URL(config.url),origin=_URL.origin;var allowedOrigins=[apiUrl];var token=localStorage.getItem('token');if(allowedOrigins.includes(origin)){config.headers.authorization=\"Bearer \".concat(token);}return config;},function(error){return Promise.reject(error);});var QuoteForm=function QuoteForm(){/*\n    Form Validation https://react-bootstrap.netlify.app/components/forms/#forms-validation-input-group\n    handleSubmit function checks that al required fields contain valid input\n    Form.Control.Feedback prompts user to correct info if necessary\n    Cannot submit form without validation\n    To fix immediate refresh on click/submit https://github.com/react-bootstrap/react-bootstrap/issues/1510\n    Stop modal from appearing if validation check fails https://stackoverflow.com/questions/58753515/bootstrap-4-validation-disable-submit-button-until-form-validated\n    */var company_factor=0.1;var price_per_gallon=1.50;var _useState=useState(0.00),_useState2=_slicedToArray(_useState,2),location_factor=_useState2[0],setLocation_factor=_useState2[1];var _useState3=useState(0.00),_useState4=_slicedToArray(_useState3,2),rate_history_factor=_useState4[0],setRate_history_factor=_useState4[1];var _useState5=useState(0.00),_useState6=_slicedToArray(_useState5,2),gallons_requested_factor=_useState6[0],setGallons_requested_factor=_useState6[1];var _useState7=useState(0.00),_useState8=_slicedToArray(_useState7,2),margin=_useState8[0],setMargin=_useState8[1];var _useState9=useState(0.00),_useState10=_slicedToArray(_useState9,2),suggested_price=_useState10[0],setSuggestedPrice=_useState10[1];var _useState11=useState(0.00),_useState12=_slicedToArray(_useState11,2),final_price=_useState12[0],setFinal_price=_useState12[1];var _useState13=useState(false),_useState14=_slicedToArray(_useState13,2),validated=_useState14[0],setValidated=_useState14[1];var _useState15=useState(''),_useState16=_slicedToArray(_useState15,2),username=_useState16[0],setUsername=_useState16[1];var _useState17=useState(0),_useState18=_slicedToArray(_useState17,2),gallons=_useState18[0],setGallons=_useState18[1];var _useState19=useState(1),_useState20=_slicedToArray(_useState19,2),gallonsInvalid=_useState20[0],setGallonsInvalid=_useState20[1];var _useState21=useState(false),_useState22=_slicedToArray(_useState21,2),checked=_useState22[0],setChecked=_useState22[1];var _useState23=useState(false),_useState24=_slicedToArray(_useState23,2),show=_useState24[0],setShow=_useState24[1];var _useState25=useState(new Date()),_useState26=_slicedToArray(_useState25,2),delivery_date=_useState26[0],setDeliveryDate=_useState26[1];var _useState27=useState('true'),_useState28=_slicedToArray(_useState27,2),disableButton=_useState28[0],setDisableButton=_useState28[1];var _useState29=useState(false),_useState30=_slicedToArray(_useState29,2),isLoading=_useState30[0],setLoading=_useState30[1];/* address from token retrieved here */var _useState31=useState(''),_useState32=_slicedToArray(_useState31,2),deliveryAddress=_useState32[0],setDeliveryAddress=_useState32[1];var _useCookies=useCookies(['user']),_useCookies2=_slicedToArray(_useCookies,2),cookies=_useCookies2[0],setCookie=_useCookies2[1];var history=useHistory();useEffect(function(){console.log('username: ',cookies.user);axios.post('http://localhost:4000/users/current_user',{username:cookies.user}).then(function(res){if(res.status===200){console.log('res.data: ',res.data);// Set username\nsetUsername(cookies.user);// Get user address info\nif(res.data.address2===null||res.data.address2===undefined){console.log('address2 is undefined');setDeliveryAddress(res.data.address1);console.log('address1: ',res.data.address1);}else{console.log('address2: ',res.data.address2);var combined_address=res.data.address1+', '+res.data.address2;console.log('combined_address: ',combined_address);setDeliveryAddress(res.data.address1+', '+res.data.address2);}// Determine location factor\nconsole.log(res.data.state);if(res.data.state===\"TX\"){setLocation_factor(0.02);}else{setLocation_factor(0.04);}console.log(username);axios.post('http://localhost:4000/users/history',{username:cookies.user}).then(function(res){if(res.data===\"\")setRate_history_factor(0.01);else setRate_history_factor(0);});}else if(res.status===404){console.log('res.status: ',res.status);history.push('/');}}).catch(function(error){console.log('Error trying to fetch user data from cookie',error);});if(isLoading){simulateNetworkRequest().then(function(){setLoading(false);});}},[isLoading]);/* Ensure that factors are updated before margin and price are calculated */useEffect(function(){console.log(\"location factor: \".concat(location_factor));console.log(\"rate history factor: \".concat(rate_history_factor));console.log(\"gallons requested factor: \".concat(gallons_requested_factor));setMargin(price_per_gallon*(location_factor-rate_history_factor+gallons_requested_factor+company_factor));setSuggestedPrice(price_per_gallon+margin);setFinal_price(gallons*suggested_price);console.log(\"calculated margin: \".concat(margin));console.log(\"calculated suggested price: \".concat(suggested_price));console.log(\"calculated final price: \".concat(final_price));// Enable \"Get Quote\" button\nsetDisableButton('false');},[location_factor,rate_history_factor,gallons_requested_factor,gallons]);var calcQuote=function calcQuote(event){var form=event.currentTarget;if(form.checkValidity()===false){event.stopPropagation();event.preventDefault();}else{event.preventDefault();setShow(true);setValidated(true);setDisableButton('true');}};var submitQuote=function submitQuote(){var quoteObj={username:username,gallons_requested:gallons,delivery_address:deliveryAddress,delivery_date:delivery_date,price_per_gallon:suggested_price};axios.post('http://localhost:4000/users/quoteupdate',quoteObj).then(function(res){console.log(res.data);}).catch(function(error){console.log(error);});setValidated(false);setShow(false);};var handleClose=function handleClose(){setValidated(false);setShow(false);};return/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsxs(Container,{className:\"profman-padding\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"title-page\",children:\"Get a Quote:\"}),/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsx(Col,{md:\"4\"}),/*#__PURE__*/_jsx(Col,{style:{\"paddingTop\":\"50px\"},children:/*#__PURE__*/_jsxs(Form,{noValidate:true,validated:validated,onSubmit:calcQuote,children:[/*#__PURE__*/_jsx(Form.Group,{controlId:\"validationGallonReq\",children:/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsx(Col,{className:\"col-auto\",style:{\"paddingLeft\":\"40px\",\"paddingTop\":\"0.5em\"},children:/*#__PURE__*/_jsx(Form.Label,{children:\"Gallons Requested:\"})}),/*#__PURE__*/_jsx(Col,{className:\"col-auto\",children:/*#__PURE__*/_jsxs(InputGroup,{hasValidation:true,children:[/*#__PURE__*/_jsx(Form.Control,{required:true,isInvalid:gallonsInvalid,className:\"gallonReq\",type:\"number\",placeholder:\"0\",min:\"1\",value:gallons,onChange:function onChange(e){setDisableButton('true');setGallons(parseInt(e.target.value));// Determine gallons requested factor\nif(gallons<1000){setGallons_requested_factor(0.03);}else{setGallons_requested_factor(0.02);}if(gallons>0){setGallonsInvalid(0);}else{setGallonsInvalid(1);}}}),/*#__PURE__*/_jsx(Form.Control.Feedback,{type:\"invalid\",children:\"Please provide a number greater than zero\"})]})})]})}),/*#__PURE__*/_jsx(Form.Group,{controlId:\"validationAddress\",children:/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsx(Col,{md:\"auto\",className:\"address-box\",children:/*#__PURE__*/_jsx(\"p\",{style:{\"font-weight\":\"bold\"},children:deliveryAddress})}),/*#__PURE__*/_jsx(Col,{style:{\"paddingTop\":\"20px\"},children:/*#__PURE__*/_jsx(Form.Check,{required:true,isInvalid:!checked,type:\"checkbox\",label:\"Correct Delivery Address?\",feedback:\"Please verify address\",onChange:function onChange(){setChecked(!checked);}})})]})}),/*#__PURE__*/_jsx(Form.Group,{children:/*#__PURE__*/_jsxs(Col,{children:[/*#__PURE__*/_jsx(Form.Label,{style:{\"paddingLeft\":\"4.2em\",\"paddingRight\":\"0.8em\"},children:\"Delivery Date: \"}),/*#__PURE__*/_jsx(DatePicker,{className:\"delivDatePicker\",selected:delivery_date,value:delivery_date,onChange:function onChange(date){setDeliveryDate(date);},minDate:new Date(),showDisabledMonthNavigation:true})]})}),/*#__PURE__*/_jsx(\"div\",{style:{\"paddingLeft\":\"140px\"},children:/*#__PURE__*/_jsx(Button,{variant:\"danger\",type:\"submit\",disable:disableButton,children:\"Get Quote\"})})]})})]}),/*#__PURE__*/_jsxs(Modal,{show:show,onHide:handleClose,backdrop:\"static\",keyboard:false,children:[/*#__PURE__*/_jsx(Modal.Header,{closeButton:true,children:/*#__PURE__*/_jsx(Modal.Title,{children:\"Calculated Cost\"})}),/*#__PURE__*/_jsxs(Modal.Body,{children:[/*#__PURE__*/_jsxs(\"p\",{children:[\"Price per gallon: $ \",parseFloat(suggested_price.toString()).toFixed(2)]}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Total cost: $ \",parseFloat(final_price.toString()).toFixed(2)]})]}),/*#__PURE__*/_jsxs(Modal.Footer,{children:[/*#__PURE__*/_jsx(Button,{variant:\"danger\",onClick:submitQuote,children:\"Submit Confirmation\"}),/*#__PURE__*/_jsx(Button,{variant:\"secondary\",onClick:handleClose,children:\"Get Another Quote\"})]})]})]})});};export default QuoteForm;","map":{"version":3,"sources":["/Users/macos10.12/Documents/GitHub/SoftwareDesignGroup23/fuel-quote-app/src/components/QuoteForm.js"],"names":["Container","Button","Form","Row","Col","Modal","InputGroup","React","useEffect","useState","DatePicker","NavBar","withCookies","useCookies","useHistory","axios","require","simulateNetworkRequest","Promise","resolve","setTimeout","apiUrl","interceptors","request","use","config","URL","url","origin","allowedOrigins","token","localStorage","getItem","includes","headers","authorization","error","reject","QuoteForm","company_factor","price_per_gallon","location_factor","setLocation_factor","rate_history_factor","setRate_history_factor","gallons_requested_factor","setGallons_requested_factor","margin","setMargin","suggested_price","setSuggestedPrice","final_price","setFinal_price","validated","setValidated","username","setUsername","gallons","setGallons","gallonsInvalid","setGallonsInvalid","checked","setChecked","show","setShow","Date","delivery_date","setDeliveryDate","disableButton","setDisableButton","isLoading","setLoading","deliveryAddress","setDeliveryAddress","cookies","setCookie","history","console","log","user","post","then","res","status","data","address2","undefined","address1","combined_address","state","push","catch","calcQuote","event","form","currentTarget","checkValidity","stopPropagation","preventDefault","submitQuote","quoteObj","gallons_requested","delivery_address","handleClose","e","parseInt","target","value","date","parseFloat","toString","toFixed"],"mappings":"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","sourcesContent":["import {Container, Button, Form, Row, Col, Modal, InputGroup} from 'react-bootstrap'\nimport React, {useEffect, useState} from \"react\";\nimport DatePicker from 'react-datepicker'\nimport NavBar from './NavBar'\nimport {withCookies, useCookies} from 'react-cookie';\nimport {useHistory} from \"react-router-dom\";\nimport axios from 'axios';\nimport './QuoteForm.css'\n\nrequire('react-datepicker/dist/react-datepicker.css')\n\nfunction simulateNetworkRequest() {\n    return new Promise((resolve) => setTimeout(resolve, 100));\n}\n\nconst apiUrl = 'http://localhost:4000';\naxios.interceptors.request.use(\n    config => {\n        const {origin} = new URL(config.url);\n        const allowedOrigins = [apiUrl];\n        const token = localStorage.getItem('token');\n        if (allowedOrigins.includes(origin)) {\n            config.headers.authorization = `Bearer ${token}`;\n        }\n        return config;\n    },\n    error => {\n        return Promise.reject(error);\n    }\n);\n\nconst QuoteForm = () => {\n    /*\n    Form Validation https://react-bootstrap.netlify.app/components/forms/#forms-validation-input-group\n    handleSubmit function checks that al required fields contain valid input\n    Form.Control.Feedback prompts user to correct info if necessary\n    Cannot submit form without validation\n    To fix immediate refresh on click/submit https://github.com/react-bootstrap/react-bootstrap/issues/1510\n    Stop modal from appearing if validation check fails https://stackoverflow.com/questions/58753515/bootstrap-4-validation-disable-submit-button-until-form-validated\n    */\n\n    const company_factor = 0.1;\n    const price_per_gallon = 1.50;\n    const [location_factor, setLocation_factor] = useState(0.00)\n    const [rate_history_factor, setRate_history_factor] = useState(0.00)\n    const [gallons_requested_factor, setGallons_requested_factor] = useState(0.00)\n    const [margin, setMargin] = useState(0.00)\n    const [suggested_price, setSuggestedPrice] = useState(0.00)\n    const [final_price, setFinal_price] = useState(0.00)\n    const [validated, setValidated] = useState(false)\n    const [username, setUsername] = useState('')\n    const [gallons, setGallons] = useState(0)\n    const [gallonsInvalid, setGallonsInvalid] = useState(1);\n    const [checked, setChecked] = useState(false)\n    const [show, setShow] = useState(false)\n    const [delivery_date, setDeliveryDate] = useState(new Date())\n    const [disableButton, setDisableButton] = useState('true');\n    const [isLoading, setLoading] = useState(false);\n    /* address from token retrieved here */\n    const [deliveryAddress, setDeliveryAddress] = useState('');\n    const [cookies, setCookie] = useCookies(['user'])\n\n    let history = useHistory();\n\n\n    useEffect(() => {\n        console.log('username: ', cookies.user);\n        axios.post('http://localhost:4000/users/current_user', {username: cookies.user})\n            .then((res) => {\n                if (res.status === 200) {\n                    console.log('res.data: ', res.data);\n                    // Set username\n                    setUsername(cookies.user)\n                    // Get user address info\n                    if (res.data.address2 === null || res.data.address2 === undefined) {\n                        console.log('address2 is undefined');\n                        setDeliveryAddress(res.data.address1);\n                        console.log('address1: ', res.data.address1);\n                    } else {\n                        console.log('address2: ', res.data.address2);\n                        let combined_address = res.data.address1 + ', ' + res.data.address2;\n                        console.log('combined_address: ', combined_address)\n                        setDeliveryAddress(res.data.address1 + ', ' + res.data.address2);\n                    }\n\n                    // Determine location factor\n                    console.log(res.data.state)\n                    if (res.data.state === \"TX\") {\n                        setLocation_factor(0.02)\n                    } else {\n                        setLocation_factor(0.04)\n                    }\n                    console.log(username)\n                    axios.post('http://localhost:4000/users/history', {username: cookies.user})\n                        .then((res) => {\n                            if (res.data === \"\") setRate_history_factor(0.01)\n                            else setRate_history_factor(0)\n                        })\n\n                } else if (res.status === 404) {\n                    console.log('res.status: ', res.status)\n                    history.push('/')\n                }\n            }).catch((error) => {\n            console.log('Error trying to fetch user data from cookie', error);\n        })\n\n        if (isLoading) {\n            simulateNetworkRequest().then(() => {\n                setLoading(false);\n            });\n        }\n    }, [isLoading]);\n\n    /* Ensure that factors are updated before margin and price are calculated */\n    useEffect(() => {\n        console.log(`location factor: ${location_factor}`)\n        console.log(`rate history factor: ${rate_history_factor}`)\n        console.log(`gallons requested factor: ${gallons_requested_factor}`)\n\n        setMargin(price_per_gallon * (location_factor - rate_history_factor + gallons_requested_factor + company_factor));\n        setSuggestedPrice(price_per_gallon + margin);\n        setFinal_price(gallons * suggested_price);\n\n        console.log(`calculated margin: ${margin}`)\n        console.log(`calculated suggested price: ${suggested_price}`)\n        console.log(`calculated final price: ${final_price}`)\n\n        // Enable \"Get Quote\" button\n        setDisableButton('false');\n\n    }, [location_factor, rate_history_factor, gallons_requested_factor, gallons])\n\n    const calcQuote = (event) => {\n        const form = event.currentTarget;\n        if (form.checkValidity() === false) {\n            event.stopPropagation()\n            event.preventDefault()\n        } else {\n            event.preventDefault();\n            setShow(true)\n            setValidated(true)\n            setDisableButton('true');\n        }\n    }\n\n    const submitQuote = () => {\n        const quoteObj = {\n            username: username,\n            gallons_requested: gallons,\n            delivery_address: deliveryAddress,\n            delivery_date: delivery_date,\n            price_per_gallon: suggested_price\n        }\n        axios.post('http://localhost:4000/users/quoteupdate', quoteObj)\n            .then((res) => {\n                console.log(res.data)\n            }).catch((error) => {\n            console.log(error)\n        });\n\n        setValidated(false);\n        setShow(false);\n    }\n\n    const handleClose = () => {\n        setValidated(false);\n        setShow(false);\n    }\n\n    return (\n        <div>\n            <Container className='profman-padding'>\n                <h1 className=\"title-page\">Get a Quote:</h1>\n                <Row>\n                    <Col md=\"4\"/>\n                    <Col style={{\"paddingTop\": \"50px\"}}>\n                        <Form noValidate validated={validated} onSubmit={calcQuote}>\n                            {/*Gallon Request*/}\n                            <Form.Group controlId='validationGallonReq'>\n\n                                <Row>\n                                    <Col className='col-auto' style={{\"paddingLeft\": \"40px\", \"paddingTop\": \"0.5em\"}}>\n                                        <Form.Label>Gallons Requested:</Form.Label>\n                                    </Col>\n                                    <Col className='col-auto'>\n                                        <InputGroup hasValidation>\n                                        <Form.Control required\n                                                      isInvalid={gallonsInvalid}\n                                                      className='gallonReq'\n                                                      type='number'\n                                                      placeholder='0'\n                                                      min='1'\n                                                      value={gallons}\n                                                      onChange={(e) => {\n                                                          setDisableButton('true');\n                                                          setGallons(parseInt(e.target.value))\n                                                          // Determine gallons requested factor\n                                                          if (gallons < 1000) {\n                                                              setGallons_requested_factor(0.03);\n                                                          } else {\n                                                              setGallons_requested_factor(0.02)\n                                                          }\n                                                          if (gallons > 0) {\n                                                              setGallonsInvalid(0)\n                                                          } else {setGallonsInvalid(1)}\n                                                      }}\n                                        />\n                                        <Form.Control.Feedback type='invalid'>Please provide a\n                                            number greater than zero</Form.Control.Feedback>\n                                        </InputGroup>\n                                    </Col>\n                                </Row>\n                            </Form.Group>\n\n                            {/*Verify Address*/}\n                            <Form.Group controlId='validationAddress'>\n                                <Row>\n                                    <Col md=\"auto\" className=\"address-box\"><p\n                                        style={{\"font-weight\": \"bold\"}}>{deliveryAddress}</p></Col>\n                                    <Col style={{\"paddingTop\": \"20px\"}}>\n                                        <Form.Check required\n                                                    isInvalid={!checked}\n                                                    type='checkbox'\n                                                    label='Correct Delivery Address?'\n                                                    feedback='Please verify address'\n                                                    onChange={() => {\n                                                        setChecked(!checked)\n                                                    }}\n                                        />\n                                    </Col>\n                                </Row>\n                            </Form.Group>\n\n                            {/*Delivery Date*/}\n                            {/* Delivery Date validated using react-datepicker DatePicker\n                https://reactdatepicker.com/\n                https://github.com/Hacker0x01/react-datepicker/issues/879\n\n                possible alt date picker https://getdatepicker.com/4/\n                */}\n                            <Form.Group>\n                                <Col>\n                                    <Form.Label style={{\"paddingLeft\": \"4.2em\", \"paddingRight\": \"0.8em\"}}>Delivery\n                                        Date: </Form.Label>\n                                    <DatePicker\n                                        className='delivDatePicker'\n                                        selected={delivery_date}\n                                        value={delivery_date}\n                                        onChange={date => {\n                                            setDeliveryDate(date)\n                                        }}\n                                        minDate={new Date()}\n                                        showDisabledMonthNavigation\n                                    />\n                                </Col>\n                            </Form.Group>\n\n                            <div style={{\"paddingLeft\": \"140px\"}}><Button variant='danger' type='submit'\n                                                                          disable={disableButton}>Get Quote</Button>\n                            </div>\n                        </Form>\n                    </Col>\n                </Row>\n\n                <Modal\n                    show={show}\n                    onHide={handleClose}\n                    backdrop='static'\n                    keyboard={false}\n                >\n                    <Modal.Header closeButton>\n                        <Modal.Title>Calculated Cost</Modal.Title>\n                    </Modal.Header>\n                    <Modal.Body>\n                        <p>Price per gallon: $ {parseFloat(suggested_price.toString()).toFixed(2)}</p>\n                        <p>Total cost: $ {parseFloat(final_price.toString()).toFixed(2)}</p>\n                    </Modal.Body>\n                    <Modal.Footer>\n                        <Button variant='danger' onClick={submitQuote}>Submit Confirmation</Button>\n                        <Button variant='secondary' onClick={handleClose}>Get Another Quote</Button>\n                    </Modal.Footer>\n                </Modal>\n            </Container>\n        </div>\n    )\n}\n\nexport default QuoteForm"]},"metadata":{},"sourceType":"module"}